# Программа коррекции массового расхода и плотности при двухфазном потоке  

## 1. Описание работы программы
Программа предназначена для исправления погрешностей кориолисового расходомера, возникающих при наличии газовой фракции в потоке жидкости (Gas Volume Fraction, GVF > 0). В таких условиях прямые измерения расхода (Cor Mass Flow) и плотности (Cor Density) становятся неточными.

Логика работы:

1. Вход: Программа принимает измеренные прибором значения массового расхода и падения плотности (Cor Density Drop).

2. Обработка: Используются обученные модели машинного обучения (на базе sklearn) для предсказания относительной ошибки расхода (Err Mass Flow [%]) и плотности (Err Density [%]).

3. Коррекция: На основе предсказанной ошибки вычисляется исправленное (истинное) значение.

4. Выход: Скорректированные значения массового расхода и плотности, максимально приближенные к эталонным.

## 2. Описание Модулей 
Проект состоит из двух модулей: модуль сравнения (обучения) и модуль использования моделей. В модуле сравнения сравниваются различные модели для выявления лучшей. На данный момент сравнены метод KNN, а именно: KNN, взвешаный KNN, K-d Tree KNN и K-d Tree + Gaussian. В модуле использования выполняется финальный этап разработки системы коррекции данных расходомера — сборка готового программного модуля и его тестирование на контрольных данных.

**Основные действия в модуле сравнения:**
1. Подготовка данных: Загрузка датасета с результатами измерений массового расхода и плотности.Очистка данных от пустых значений и переименование столбцов для удобства работы.Определение ключевых признаков для моделей: измеренный расход (Cor Mass Flow) и падение плотности (Cor Density Drop).

3. Работа с моделями: Разделение данных на обучающую и тестовую выборки с помощью train_test_split. Масштабирование признаков с использованием StandardScaler или MinMaxScaler. Обучение моделей для предсказания ошибок, а так же сохранение лучших версий в файлы .pkl для последующего использования в модуле использования .

**Вот основные действия в модуле использования:**

1. Загрузка моделей: Программа скачивает из репозитория GitHub (flow_meter) предобученные модели в формате .pkl (best_model_mass_flow.pkl и best_model_density.pkl) и копирует их в рабочую директорию.

2. Создание ядра программы (cor.py): С помощью магической команды %%writefile создается Python-скрипт, содержащий класс CoriolisModel. Этот класс реализует логику предсказания ошибки.

3. Автоматизация тестирования (run_cor.py): Создается дополнительный скрипт для пакетной обработки данных из CSV-файла. Он загружает тестовый набор данных, прогоняет их через модели и выводит таблицу с результатами: входными данными, исправленным выходом и временем обработки каждой точки.

4. Экспорт проекта: В конце все компоненты (скрипты, модели, тесты) упаковываются в архив my_project.zip для скачивания и использования вне среды разработки.

## 3. Процедура тестирования:
1. Запустить сравнение.ipynb. В конце выполнения лучшие модели сохранятся в репозетории
2. Зупустить модуль1_2(V2).ipynb. Во время выполнения с репозитория подтянутся модели, которые будут использоваться. В конце можно скачать все используемые скрипты для тестирования на локальной машине.
